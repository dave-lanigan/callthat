---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# callthat

<!-- badges: start -->
<!-- badges: end -->

`callthat` is meant for `plumber` API developers who plan to distribute their APIs inside an R package.  This package enables the testing of the API's endpoints within the `testthat` framework.  This allows the R Checks to also confirm that the endpoints still behave as expected.  The ultimate goal of `callthat` is to ensure for the package's automated testing confirms that the APIs still work even if the developer did not run the package's test locally.

## Installation

The development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("edgararuiz/callthat")
```

## Usage

```{r}
library(magrittr)
library(httr)
```


### Local

```{r}
library(callthat)

my_api <- callthat_plumber_start()

```


```{r}
my_api %>% 
  callthat_api_get("data") 
```



```{r}
my_api %>% 
  callthat_api_get("predict", query = list(weight = 2)) 
```

```{r}
my_api %>% 
  callthat_api_post("predict", body = list(weight = 2)) 
```


### RStudio Connect

```{r}
rsc_api <- callthat_rsc_connection("https://colorado.rstudio.com/rsc/access-to-care/api")

rsc_api
```

```{r}
rsc_api %>% 
  callthat_api_get("summary", list("state" = "CA")) %>% 
  content()
```

### Secured API inside RStudio Connect 

```{r}
secured_api <- callthat_rsc_connection(url = "https://colorado.rstudio.com/rsc/callthat/testapi",
                                       key = Sys.getenv("CONNECT_API_KEY"))

secured_api
```

```{r}
callthat_api_get(secured_api, "data") 
```

```{r}
callthat_api_post(secured_api, "sum", list(a = 2, b = 2)) %>% 
  content("parsed")
```


### Generic connection

```{r}
generic_api <- callthat_connection("http://httpbin.org")

generic_api
```

```{r}
callthat_api_post(generic_api, endpoint = "post", body = "A simple text")
```


```{r}
remote_api <- callthat_connection("https://colorado.rstudio.com/rsc/access-to-care/api")

remote_api
```


```{r}
la_summary <- callthat_api_get(remote_api, "summary", list("state" = "LA"))

httr::content(la_summary)
```

